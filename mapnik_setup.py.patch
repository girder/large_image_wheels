diff --git a/setup.py b/setup.py
index a72565629..c6bae7f98 100755
--- a/setup.py
+++ b/setup.py
@@ -13,15 +13,8 @@ def check_output(args):
      return output.rstrip('\n')
 
 linkflags = []
-bin_path = os.path.join(check_output([mapnik_config, '--prefix']),'bin')
-lib_path = os.path.join(check_output([mapnik_config, '--prefix']),'lib')
-linkflags.extend(check_output([mapnik_config, '--libs']).split(' '))
-linkflags.extend(check_output([mapnik_config, '--ldflags']).split(' '))
-linkflags.extend(check_output([mapnik_config, '--dep-libs']).split(' '))
-linkflags.extend([
-    '-lmapnik-wkt',
-    '-lmapnik-json',
-])
+lib_path = check_output(['pkg-config', 'libmapnik', '--variable', 'libdir'])
+linkflags.extend(check_output(['pkg-config', 'libmapnik', '--libs']).split(' '))
 
 # Remove symlinks
 if os.path.islink('packaging/mapnik/bin') :
@@ -33,34 +26,28 @@ f_paths = open('packaging/mapnik/paths.py', 'w')
 f_paths.write('import os\n')
 f_paths.write('\n')
 
-if os.environ.get('SYSTEM_MAPNIK'):
-     input_plugin_path = check_output([mapnik_config, '--input-plugins'])
-     font_path = check_output([mapnik_config, '--fonts'])
-     f_paths.write("mapniklibpath = '{path}'\n".format(path=lib_path))
-     f_paths.write("inputpluginspath = '{path}'\n".format(path=input_plugin_path))
-     f_paths.write("fontscollectionpath = '{path}'\n".format(path=font_path))
-else:
-     if not os.path.exists('packaging/mapnik/bin'):
-          os.symlink(bin_path, 'packaging/mapnik/bin')
-     if not os.path.exists('packaging/mapnik/lib') :
-          os.symlink(lib_path, 'packaging/mapnik/lib')
-     else:
-          names = (name for name in os.listdir(lib_path) if os.path.isfile(os.path.join(lib_path, name)))
-          for name in names:
-               if not os.path.exists(os.path.join('packaging/mapnik/lib', name)):
-                    os.symlink(os.path.join(lib_path, name), os.path.join('packaging/mapnik/lib', name))
-          input_plugin_path = check_output([mapnik_config, '--input-plugins'])
-          if not os.path.exists('packaging/mapnik/lib/mapnik/input'):
-               os.symlink(input_plugin_path, 'packaging/mapnik/lib/mapnik/input')
-     f_paths.write("mapniklibpath = os.path.join(os.path.dirname(__file__), 'lib')\n")
-     f_paths.write("inputpluginspath = os.path.join(os.path.dirname(__file__), 'lib/mapnik/input')\n")
-     f_paths.write("fontscollectionpath = os.path.join(os.path.dirname(__file__), 'lib/mapnik/fonts')\n")
+input_plugin_path = os.path.join(lib_path, 'mapnik', 'input')
+font_path = os.path.join(lib_path, 'mapnik', 'fonts')
 
-f_paths.write("__all__ = [mapniklibpath,inputpluginspath,fontscollectionpath]\n")
-f_paths.close()
+if os.environ.get('LIB_DIR_NAME'):
+    mapnik_lib_path = lib_path + os.environ.get('LIB_DIR_NAME')
+else:
+    mapnik_lib_path = lib_path + "/mapnik"
+    f_paths.write("mapniklibpath = '{path}'\n".format(path=mapnik_lib_path))
+    f_paths.write(
+        "inputpluginspath = '{path}'\n".format(path=input_plugin_path))
+    f_paths.write(
+        "fontscollectionpath = '{path}'\n".format(path=font_path))
+    f_paths.write("localpath = os.path.dirname(os.path.abspath( __file__ ))\n")
+    f_paths.write("mapniklibpath = os.path.join(localpath, 'mapnik.libs')\n")
+    f_paths.write("mapniklibpath = os.path.normpath(mapniklibpath)\n")
+    f_paths.write("inputpluginspath = os.path.join(localpath, 'input')\n")
+    f_paths.write("fontscollectionpath = os.path.join(localpath, 'fonts')\n")
+    f_paths.write(
+        "__all__ = [mapniklibpath,inputpluginspath,fontscollectionpath]\n")
+    f_paths.close()
 
-extra_comp_args = check_output([mapnik_config, '--cflags']).split(' ')
-extra_comp_args = list(filter(lambda arg: arg != "-fvisibility=hidden", extra_comp_args))
+extra_comp_args = check_output(['pkg-config', 'libmapnik', '--cflags']).split(' ')
 
 if sys.platform == 'darwin':
      pass
@@ -128,9 +115,9 @@ ext_modules = [
 ]
 
 if os.environ.get("CC", False) == False:
-    os.environ["CC"] = check_output([mapnik_config, '--cxx'])
+    os.environ["CC"] = 'c++'
 if os.environ.get("CXX", False) == False:
-    os.environ["CXX"] = check_output([mapnik_config, '--cxx'])
+    os.environ["CXX"] = 'c++'
 
 setup(
      name="mapnik",
@@ -138,7 +125,7 @@ setup(
      packages=find_namespace_packages(where="packaging"),
      package_dir={"": "packaging"},
      package_data={
-          "mapnik.include": ["*.hpp"],
+	  'mapnik': ['lib/*.*', 'lib/*/*/*', 'share/*/*', 'input/*', 'fonts/*', 'proj/*', 'gdal/*', 'bin/*'],
           "mapnik.bin": ["*"],
           "mapnik.lib": ["libmapnik*"],
           "mapnik.lib.mapnik.fonts":["*"],
@@ -149,5 +136,6 @@ setup(
           "mapnik.lib": ["*.a"]
      },
      ext_modules=ext_modules,
+     entry_points={'console_scripts': ['%s=mapnik.bin:program' % name for name in os.listdir('packaging/mapnik/bin') if not name.endswith('.py')]},
      cmdclass={"build_ext": build_ext},
 )
